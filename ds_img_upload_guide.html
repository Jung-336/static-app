<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€í™”í˜• FastAPI + Supabase ì´ë¯¸ì§€ ì—…ë¡œë“œ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F8F7F4;
            color: #3D3D3D;
        }
        .content-card {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .nav-button {
            background-color: #ECEBE8;
            color: #5A5A5A;
            transition: all 0.2s ease;
        }
        .nav-button.active, .nav-button:hover {
            background-color: #A3B8A3;
            color: #FFFFFF;
        }
        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'D2Coding', 'Consolas', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            overflow-x: auto;
        }
        .flow-step {
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .flow-step:hover, .flow-step.active-step {
            border-color: #A3B8A3;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .arrow {
            font-size: 2rem;
            color: #A3B8A3;
        }
        #detail-view {
            transition: opacity 0.5s ease-in-out;
        }
        .hidden-section {
            display: none;
        }
        .interactive-select {
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            width: 100%;
            transition: border-color 0.2s ease;
        }
        .interactive-select:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #A3B8A3;
            box-shadow: 0 0 0 2px rgba(163, 184, 163, 0.5);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">FastAPI & Supabase</h1>
            <p class="text-xl text-gray-600">ëŒ€í™”í˜• ì´ë¯¸ì§€ ì—…ë¡œë“œ ê°€ì´ë“œ</p>
        </header>

        <main>
            <nav class="flex justify-center space-x-2 md:space-x-4 mb-12">
                <button data-target="flow" class="nav-button font-semibold py-2 px-4 rounded-full active">ğŸš€ ì—…ë¡œë“œ íë¦„</button>
                <button data-target="config" class="nav-button font-semibold py-2 px-4 rounded-full">âš™ï¸ í™˜ê²½ ì„¤ì •</button>
                <button data-target="code" class="nav-button font-semibold py-2 px-4 rounded-full">ğŸ’» ì½”ë“œ íƒìƒ‰ê¸°</button>
                <button data-target="errors" class="nav-button font-semibold py-2 px-4 rounded-full">ğŸš¨ ì˜¤ë¥˜ í•¸ë“¤ë§</button>
            </nav>
            
            <div id="app-content">

                <section id="flow-section">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold mb-2">ì—…ë¡œë“œ í”„ë¡œì„¸ìŠ¤ ì‹œê°í™”</h2>
                        <p class="text-gray-600 max-w-3xl mx-auto">ì „ì²´ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ë‚˜íƒ€ë‚¸ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤. ê° ë‹¨ê³„ë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸í•œ ì„¤ëª…ê³¼ ì£¼ìš” í¬ì¸íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                    </div>

                    <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-8">
                        <div id="step-client" data-step="client" class="flow-step content-card p-4 text-center w-48">
                            <div class="text-4xl">ğŸ“±</div>
                            <h3 class="font-bold mt-2">í´ë¼ì´ì–¸íŠ¸</h3>
                            <p class="text-sm text-gray-500">ì´ë¯¸ì§€ ì „ì†¡</p>
                        </div>
                        <div class="arrow hidden md:block">â†’</div>
                        <div id="step-fastapi" data-step="fastapi" class="flow-step content-card p-4 text-center w-48">
                           <div class="text-4xl">âš¡ï¸</div>
                            <h3 class="font-bold mt-2">FastAPI ì„œë²„</h3>
                            <p class="text-sm text-gray-500">íŒŒì¼ ìˆ˜ì‹  ë° ê²€ì¦</p>
                        </div>
                        <div class="arrow hidden md:block">â†’</div>
                        <div id="step-supabase" data-step="supabase" class="flow-step content-card p-4 text-center w-48">
                            <div class="text-4xl">ğŸ“¦</div>
                            <h3 class="font-bold mt-2">Supabase</h3>
                            <p class="text-sm text-gray-500">ë³´ì•ˆ ì •ì±… & ì €ì¥</p>
                        </div>
                         <div class="arrow hidden md:block">â†’</div>
                        <div id="step-storage" data-step="storage" class="flow-step content-card p-4 text-center w-48">
                            <div class="text-4xl">ğŸ’¾</div>
                            <h3 class="font-bold mt-2">ìŠ¤í† ë¦¬ì§€</h3>
                            <p class="text-sm text-gray-500">íŒŒì¼ ì €ì¥ ì™„ë£Œ</p>
                        </div>
                    </div>
                    
                    <div id="detail-view" class="content-card p-6 md:p-8 min-h-[20rem] opacity-0">
                        </div>
                </section>
                
                <section id="config-section" class="hidden-section">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold mb-2">ëŒ€í™”í˜• í™˜ê²½ ì„¤ì •</h2>
                        <p class="text-gray-600 max-w-3xl mx-auto">Supabaseì˜ í•µì‹¬ ì„¤ì •ì¸ ìŠ¤í† ë¦¬ì§€ ë²„í‚·ê³¼ í–‰ ìˆ˜ì¤€ ë³´ì•ˆ(RLS)ì„ ì§ì ‘ êµ¬ì„±í•´ë³´ë©° ì›ë¦¬ë¥¼ ì´í•´í•´ ë³´ì„¸ìš”.</p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="content-card p-6">
                            <h3 class="text-2xl font-bold mb-4">ë²„í‚· ìƒì„± ì‹œë®¬ë ˆì´í„°</h3>
                             <p class="text-gray-500 mb-4">ë²„í‚· ìœ í˜•ê³¼ ì œí•œì‚¬í•­ì„ ì„ íƒí•˜ë©´, ì´ë¥¼ ìƒì„±í•˜ëŠ” Python ì½”ë“œê°€ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="font-semibold block mb-2">ë²„í‚· ì ‘ê·¼ ëª¨ë¸</label>
                                    <div class="flex space-x-2">
                                        <button id="bucket-private" class="flex-1 nav-button py-2 px-4 rounded-md active">Private (ê¸°ë³¸ê°’)</button>
                                        <button id="bucket-public" class="flex-1 nav-button py-2 px-4 rounded-md">Public</button>
                                    </div>
                                </div>
                                <div>
                                    <label for="bucket-size-limit" class="font-semibold block mb-2">ìµœëŒ€ íŒŒì¼ í¬ê¸° (MB)</label>
                                    <input type="number" id="bucket-size-limit" value="5" class="interactive-select">
                                </div>
                                <div>
                                    <label class="font-semibold block mb-2">í—ˆìš© MIME íƒ€ì…</label>
                                    <div class="flex items-center space-x-4">
                                        <label><input type="checkbox" class="mime-type" value="image/png" checked> PNG</label>
                                        <label><input type="checkbox" class="mime-type" value="image/jpeg" checked> JPEG</label>
                                        <label><input type="checkbox" class="mime-type" value="image/gif"> GIF</label>
                                    </div>
                                </div>
                                <div id="bucket-code-output" class="code-block"></div>
                            </div>
                        </div>
                        <div class="content-card p-6">
                            <h3 class="text-2xl font-bold mb-4">RLS ì •ì±… ë¹Œë”</h3>
                             <p class="text-gray-500 mb-4">ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì—¬ í•„ìš”í•œ í–‰ ìˆ˜ì¤€ ë³´ì•ˆ(RLS) SQL ì •ì±…ì„ í™•ì¸í•˜ì„¸ìš”. RLSëŠ” Supabase ë³´ì•ˆì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>
                            <select id="rls-scenario" class="interactive-select mb-4">
                                <option value="auth-insert">ì¸ì¦ëœ ì‚¬ìš©ìë§Œ 'images' ë²„í‚·ì— ì—…ë¡œë“œ</option>
                                <option value="owner-insert">ìì‹ ì˜ í´ë”(UID ê¸°ë°˜)ì—ë§Œ ì—…ë¡œë“œ</option>
                                <option value="owner-select">ìì‹ ì´ ì—…ë¡œë“œí•œ íŒŒì¼ë§Œ ë³´ê¸°</option>
                                <option value="owner-update">ìì‹ ì´ ì—…ë¡œë“œí•œ íŒŒì¼ë§Œ ìˆ˜ì •/ë®ì–´ì“°ê¸°</option>
                                <option value="public-select">ëª¨ë“  ì‚¬ìš©ìê°€ 'public' ë²„í‚· íŒŒì¼ ë³´ê¸°</option>
                            </select>
                            <div id="rls-code-output" class="code-block"></div>
                        </div>
                    </div>
                </section>

                <section id="code-section" class="hidden-section">
                     <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold mb-2">FastAPI ì½”ë“œ íƒìƒ‰ê¸°</h2>
                        <p class="text-gray-600 max-w-3xl mx-auto">ì‹¤ì œ ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” FastAPI ì—”ë“œí¬ì¸íŠ¸ì˜ ì „ì²´ ì½”ë“œì…ë‹ˆë‹¤. ê° ë‹¨ê³„ë³„ë¡œ ì£¼ì„ì„ í†µí•´ ìƒì„¸íˆ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                    <div class="content-card p-6">
                         <div id="code-output" class="code-block"></div>
                    </div>
                </section>

                <section id="errors-section" class="hidden-section">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold mb-2">ì˜¤ë¥˜ ì²˜ë¦¬ ì‹œë®¬ë ˆì´í„°</h2>
                        <p class="text-gray-600 max-w-3xl mx-auto">Supabase ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì£¼ìš” ì˜¤ë¥˜ì™€ FastAPIì—ì„œ ì´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”ì§€ ì•Œì•„ë³´ì„¸ìš”.</p>
                    </div>
                     <div class="content-card p-6 md:p-8">
                        <select id="error-scenario" class="interactive-select mb-6">
                            <option value="AccessDenied">AccessDenied (ì ‘ê·¼ ê±°ë¶€)</option>
                            <option value="EntityTooLarge">EntityTooLarge (íŒŒì¼ ë„ˆë¬´ í¼)</option>
                            <option value="ResourceAlreadyExists">ResourceAlreadyExists (íŒŒì¼ ì´ë¯¸ ì¡´ì¬)</option>
                            <option value="InvalidMimeType">InvalidMimeType (ì˜ëª»ëœ íŒŒì¼ íƒ€ì…)</option>
                        </select>
                        <div id="error-output" class="grid md:grid-cols-3 gap-6 text-center">
                            </div>
                    </div>
                </section>

            </div>
        </main>
        
        <footer class="text-center mt-16 text-gray-500">
            <p>ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì œê³µëœ ê¸°ìˆ  ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const flowDetailData = {
                client: {
                    title: '1. í´ë¼ì´ì–¸íŠ¸: ì´ë¯¸ì§€ ì „ì†¡',
                    content: `
                        <p class="mb-4">ì‚¬ìš©ìëŠ” ì›¹ ë¸Œë¼ìš°ì €ë‚˜ ëª¨ë°”ì¼ ì•±ê³¼ ê°™ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê³  ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ ìš”ì²­ì€ ì¼ë°˜ì ìœ¼ë¡œ HTTP POST ìš”ì²­ì´ë©°, 'multipart/form-data' í˜•ì‹ìœ¼ë¡œ íŒŒì¼ì„ í¬í•¨í•©ë‹ˆë‹¤.</p>
                        <h4 class="font-bold mb-2">ì£¼ìš” í¬ì¸íŠ¸:</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            <li>ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤(UI)ì—ì„œ íŒŒì¼ ì…ë ¥(<code>&lt;input type="file"&gt;</code>)ì„ í†µí•´ íŒŒì¼ ì„ íƒ</li>
                            <li>Fetch API ë˜ëŠ” Axios ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ë¡œ ìš”ì²­ ì „ì†¡</li>
                            <li>ìš”ì²­ í—¤ë”ì˜ <code>Content-Type</code>ì€ <code>multipart/form-data</code>ë¡œ ì„¤ì •ë¨</li>
                        </ul>`
                },
                fastapi: {
                    title: '2. FastAPI ì„œë²„: ìˆ˜ì‹  ë° ê²€ì¦',
                    content: `
                        <p class="mb-4">FastAPI ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ <code>UploadFile</code> ê°ì²´ë¡œ íŒŒì¼ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì„ ìœ„í•´ íŒŒì¼ì´ ë„ˆë¬´ í¬ë©´ ì„ì‹œ ë””ìŠ¤í¬ íŒŒì¼ë¡œ ìë™ ì €ì¥ë©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
                        <h4 class="font-bold mb-2">ì£¼ìš” í¬ì¸íŠ¸:</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            <li><strong>íŒŒì¼ ìˆ˜ì‹ :</strong> <code>UploadFile</code> íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ê³¼ ë©”íƒ€ë°ì´í„°(íŒŒì¼ëª…, MIME íƒ€ì…)ë¥¼ ì–»ìŠµë‹ˆë‹¤.</li>
                            <li><strong>MIME íƒ€ì… ê²€ì¦:</strong> <code>file.content_type</code>ì´ í—ˆìš©ëœ ì´ë¯¸ì§€ í˜•ì‹(ì˜ˆ: 'image/jpeg', 'image/png')ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li>
                            <li><strong>íŒŒì¼ í¬ê¸° ê²€ì¦:</strong> <code>await file.read()</code>ë¡œ íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ ê·¸ í¬ê¸°ê°€ ì„¤ì •ëœ ìµœëŒ€ì¹˜ë¥¼ ì´ˆê³¼í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li>
                            <li>ì´ëŠ” Supabase ë²„í‚· ì„¤ì •ê³¼ ë³„ê°œë¡œ, ë¶ˆí•„ìš”í•œ íŠ¸ë˜í”½ì„ ì¤„ì´ëŠ” 2ì°¨ ë°©ì–´ì„  ì—­í• ì„ í•©ë‹ˆë‹¤.</li>
                        </ul>`
                },
                supabase: {
                    title: '3. Supabase: ë³´ì•ˆ ì •ì±… ë° ì—…ë¡œë“œ',
                    content: `
                        <p class="mb-4">íŒŒì¼ì´ ìœ íš¨í•˜ë©´, FastAPI ì„œë²„ëŠ” Supabase Python í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ Supabase ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤. ì—…ë¡œë“œ ìš”ì²­ ì‹œ, SupabaseëŠ” ë¨¼ì € ì •ì˜ëœ í–‰ ìˆ˜ì¤€ ë³´ì•ˆ(RLS) ì •ì±…ì„ ê²€ì‚¬í•˜ì—¬ í•´ë‹¹ ì‘ì—…ì„ í—ˆìš©í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.</p>
                        <h4 class="font-bold mb-2">ì£¼ìš” í¬ì¸íŠ¸:</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            <li><strong>RLS ì •ì±… ê²€ì‚¬:</strong> <code>storage.objects</code> í…Œì´ë¸”ì— ëŒ€í•œ <code>INSERT</code> ì •ì±…ì´ ë¨¼ì € í‰ê°€ë©ë‹ˆë‹¤. ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€, ì˜¬ë°”ë¥¸ ë²„í‚·ì¸ì§€, íŠ¹ì • í´ë” ê·œì¹™ì„ ë”°ë¥´ëŠ”ì§€ ë“±ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>
                            <li><strong>ë²„í‚· ì œí•œ ê²€ì‚¬:</strong> RLSë¥¼ í†µê³¼í•˜ë©´ ë²„í‚· ìì²´ì— ì„¤ì •ëœ MIME íƒ€ì… ë° íŒŒì¼ í¬ê¸° ì œí•œì„ ë‹¤ì‹œ í™•ì¸í•©ë‹ˆë‹¤.</li>
                            <li><strong>ì—…ë¡œë“œ ì‹¤í–‰:</strong> <code>supabase.storage.from_('bucket-name').upload(...)</code> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œê°€ ì§„í–‰ë©ë‹ˆë‹¤.</li>
                        </ul>`
                },
                storage: {
                    title: '4. ìŠ¤í† ë¦¬ì§€: íŒŒì¼ ì €ì¥ ì™„ë£Œ',
                    content: `
                        <p class="mb-4">ëª¨ë“  ê²€ì¦ê³¼ ì •ì±… ê²€ì‚¬ë¥¼ í†µê³¼í•˜ë©´ íŒŒì¼ì€ Supabase ìŠ¤í† ë¦¬ì§€ ë²„í‚· ë‚´ ì§€ì •ëœ ê²½ë¡œì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ê³ ìœ í•œ íŒŒì¼ëª…ì„ ìƒì„±í•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>
                        <h4 class="font-bold mb-2">ì£¼ìš” í¬ì¸íŠ¸:</h4>
                        <ul class="list-disc list-inside text-gray-700">
                            <li><strong>ê³ ìœ í•œ ê²½ë¡œ ìƒì„±:</strong> ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ <code>UUID</code>ì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ëª…ì„ ê³ ìœ í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. (ì˜ˆ: <code>uploads/{uuid.uuid4()}.png</code>)</li>
                            <li><strong>ê³µê°œ URL:</strong> ë²„í‚·ì´ Publicì´ê±°ë‚˜, Private ë²„í‚·ì— ëŒ€í•œ ì„œëª…ëœ URL(Signed URL)ì„ ìƒì„±í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¯¸ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” URLì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            <li><strong>ì„±ê³µ ì‘ë‹µ:</strong> FastAPIëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì €ì¥ëœ íŒŒì¼ì˜ ê²½ë¡œ ë˜ëŠ” URLì„ ë°˜í™˜í•©ë‹ˆë‹¤.</li>
                        </ul>`
                }
            };

            const rlsPolicies = {
                'auth-insert': {
                    description: 'ì¸ì¦ëœ(ë¡œê·¸ì¸í•œ) ëª¨ë“  ì‚¬ìš©ìê°€ `images` ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ê°€ì¥ ê¸°ë³¸ì ì¸ ì—…ë¡œë“œ ì •ì±…ì…ë‹ˆë‹¤.',
                    sql: `CREATE POLICY "Authenticated users can upload"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK ( bucket_id = 'images' );`
                },
                'owner-insert': {
                    description: "ì‚¬ìš©ìê°€ ìì‹ ì˜ ê³ ìœ  ID(UID)ì™€ ë™ì¼í•œ ì´ë¦„ì˜ í´ë” ë‚´ì—ë§Œ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ì œí•œí•©ë‹ˆë‹¤. (ì˜ˆ: `user-files/USER_ID_123/avatar.png`) ì‚¬ìš©ì ë°ì´í„°ë¥¼ ê²©ë¦¬í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.",
                    sql: `CREATE POLICY "User can upload to own folder"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
  bucket_id = 'user-files' AND
  (storage.foldername(name))[1] = auth.uid()::text
);`
                },
                'owner-select': {
                    description: 'ì‚¬ìš©ìê°€ ìì‹ ì´ ì†Œìœ í•œ(ì—…ë¡œë“œí•œ) íŒŒì¼ë§Œ ì¡°íšŒí•˜ê³  ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. `owner_id`ëŠ” íŒŒì¼ ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì—…ë¡œë”ì˜ UIDë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.',
                    sql: `CREATE POLICY "User can view their own files"
ON storage.objects FOR SELECT
TO authenticated
USING ( owner_id = auth.uid() );`
                },
                'owner-update': {
                    description: 'ì‚¬ìš©ìê°€ ìì‹ ì´ ì†Œìœ í•œ íŒŒì¼ë§Œ ìˆ˜ì •í•˜ê±°ë‚˜ ë®ì–´ì“¸ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. `upsert: true` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì´ ì •ì±…ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                    sql: `CREATE POLICY "User can update their own files"
ON storage.objects FOR UPDATE
TO authenticated
USING ( owner_id = auth.uid() )
WITH CHECK ( owner_id = auth.uid() );`
                },
                'public-select': {
                    description: "ì¸ì¦ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ëª¨ë“  ì‚¬ìš©ìê°€ 'public' ë²„í‚·ì— ìˆëŠ” íŒŒì¼ì„ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ë²„í‚· ìì²´ì˜ Public ì„¤ì •ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ê±°ë‚˜, ë” ë³µì¡í•œ ê³µê°œ ê·œì¹™ì„ ìœ„í•´ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    sql: `CREATE POLICY "Public read access"
ON storage.objects FOR SELECT
TO public
USING ( bucket_id = 'public' );`
                }
            };
            
            const fullCode = `
# main.py - FastAPI ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸
import uuid
from fastapi import FastAPI, File, UploadFile, HTTPException
from pydantic_settings import BaseSettings, SettingsConfigDict
from supabase import create_client, Client

# --- 1. ì„¤ì • ê´€ë¦¬ (Pydantic BaseSettings) ---
# í™˜ê²½ ë³€ìˆ˜(.env íŒŒì¼)ë¥¼ ë¡œë“œí•˜ê³  ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
class Settings(BaseSettings):
    SUPABASE_URL: str
    SUPABASE_KEY: str # ë³´í†µ ë°±ì—”ë“œì—ì„œëŠ” service_role_keyë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    IMAGE_BUCKET_NAME: str = "images"
    MAX_IMAGE_SIZE_MB: int = 5
    ALLOWED_IMAGE_TYPES: list[str] = ["image/jpeg", "image/png"]

    model_config = SettingsConfigDict(env_file=".env")

settings = Settings()

# --- 2. Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ---
# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
supabase_client: Client = create_client(settings.SUPABASE_URL, settings.SUPABASE_KEY)

app = FastAPI()

# --- 3. ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸ ---
@app.post("/upload-image/")
async def upload_image_endpoint(file: UploadFile = File(...)):
    """
    ì´ë¯¸ì§€ íŒŒì¼ì„ ë°›ì•„ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ê±°ì¹œ í›„ Supabase ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
    """
    # --- 4. ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ ---
    if file.content_type not in settings.ALLOWED_IMAGE_TYPES:
        raise HTTPException(status_code=400, detail="í—ˆìš©ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ íƒ€ì…ì…ë‹ˆë‹¤.")

    contents = await file.read()
    if len(contents) > settings.MAX_IMAGE_SIZE_MB * 1024 * 1024:
        raise HTTPException(status_code=413, detail="íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤.")

    # --- 5. ê³ ìœ  íŒŒì¼ëª… ìƒì„± ---
    file_extension = file.filename.split(".")[-1]
    unique_path = f"public/{uuid.uuid4()}.{file_extension}"

    try:
        # --- 6. Supabaseì— íŒŒì¼ ì—…ë¡œë“œ ---
        # supabase-pyëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ë¯€ë¡œ, ë¹„ë™ê¸° ì—”ë“œí¬ì¸íŠ¸ì—ì„œëŠ”
        # starlette.concurrency.run_in_threadpoolì„ ì‚¬ìš©í•˜ê±°ë‚˜,
        # ë¹„ë™ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬(supabase-py-async)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
        # ì´ ì˜ˆì œì—ì„œëŠ” í¸ì˜ìƒ ë™ê¸° ì½”ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        supabase_client.storage.from_(settings.IMAGE_BUCKET_NAME).upload(
            path=unique_path,
            file=contents,
            file_options={"content-type": file.content_type, "upsert": "false"}
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ìŠ¤í† ë¦¬ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: {str(e)}")

    # --- 7. ê³µê°œ URL ê°€ì ¸ì˜¤ê¸° ë° ë°˜í™˜ ---
    public_url = supabase_client.storage.from_(settings.IMAGE_BUCKET_NAME).get_public_url(unique_path)

    return {"message": "ì—…ë¡œë“œ ì„±ê³µ!", "url": public_url}
`;
            
             const errorData = {
                AccessDenied: {
                    code: '403 Forbidden',
                    reason: 'RLS(í–‰ ìˆ˜ì¤€ ë³´ì•ˆ) ì •ì±…ì´ í•´ë‹¹ ì‘ì—…ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.',
                    solution: 'Supabase ëŒ€ì‹œë³´ë“œì—ì„œ Storage -> Policiesë¥¼ í™•ì¸í•˜ì„¸ìš”. ì‚¬ìš©ìì˜ ì—­í• (ì˜ˆ: `authenticated`)ì— ëŒ€í•´ ìš”ì²­í•˜ëŠ” ì‘ì—…(ì˜ˆ: `INSERT`)ì„ í—ˆìš©í•˜ëŠ” ì •ì±…ì´ ì˜¬ë°”ë¥¸ `bucket_id`ì™€ ì¡°ê±´ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ ê²€í† í•´ì•¼ í•©ë‹ˆë‹¤.'
                },
                EntityTooLarge: {
                    code: '413 Payload Too Large',
                    reason: 'ì—…ë¡œë“œí•œ íŒŒì¼ì´ Supabase ë²„í‚·ì— ì„¤ì •ëœ `file_size_limit`ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.',
                    solution: 'FastAPI ì„œë²„ì—ì„œ 1ì°¨ì ìœ¼ë¡œ íŒŒì¼ í¬ê¸°ë¥¼ ê²€ì¦í•˜ê³ , Supabase ë²„í‚· ì„¤ì •ì—ì„œ íŒŒì¼ í¬ê¸° ì œí•œì„ ëŠ˜ë¦¬ê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë” ì‘ì€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë„ë¡ ì•ˆë‚´í•´ì•¼ í•©ë‹ˆë‹¤.'
                },
                ResourceAlreadyExists: {
                    code: '409 Conflict',
                    reason: 'ë™ì¼í•œ ê²½ë¡œì— íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ë©°, `upsert` ì˜µì…˜ì´ `false`ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    solution: 'íŒŒì¼ ë®ì–´ì“°ê¸°ë¥¼ í—ˆìš©í•˜ë ¤ë©´ `file_options={"upsert": "true"}`ë¡œ ì„¤ì •í•˜ì„¸ìš”. ë˜ëŠ” UUID ë“±ì„ ì‚¬ìš©í•˜ì—¬ í•­ìƒ ê³ ìœ í•œ íŒŒì¼ ê²½ë¡œë¥¼ ìƒì„±í•˜ì—¬ ì—…ë¡œë“œí•˜ë©´ ì¶©ëŒì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                },
                InvalidMimeType: {
                    code: '400 Bad Request',
                    reason: 'ì—…ë¡œë“œí•œ íŒŒì¼ì˜ MIME íƒ€ì…ì´ ë²„í‚·ì˜ `allowed_mime_types` ëª©ë¡ì— ì—†ìŠµë‹ˆë‹¤.',
                    solution: 'FastAPIì—ì„œ 1ì°¨ì ìœ¼ë¡œ MIME íƒ€ì…ì„ ê²€ì¦í•˜ê³ , Supabase ë²„í‚· ì„¤ì •ì—ì„œ í—ˆìš©í•  MIME íƒ€ì… ëª©ë¡ì„ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.'
                }
            };


            const navButtons = document.querySelectorAll('.nav-button');
            const sections = {
                flow: document.getElementById('flow-section'),
                config: document.getElementById('config-section'),
                code: document.getElementById('code-section'),
                errors: document.getElementById('errors-section')
            };

            const flowSteps = document.querySelectorAll('.flow-step');
            const detailView = document.getElementById('detail-view');

            function switchTab(targetId) {
                Object.values(sections).forEach(section => section.classList.add('hidden-section'));
                sections[targetId].classList.remove('hidden-section');

                navButtons.forEach(button => {
                    button.classList.toggle('active', button.dataset.target === targetId);
                });
            }
            
            navButtons.forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.target));
            });

            function updateDetailView(stepId) {
                const data = flowDetailData[stepId];
                if (data) {
                    detailView.innerHTML = `
                        <h3 class="text-2xl font-bold mb-4">${data.title}</h3>
                        <div>${data.content}</div>
                    `;
                    detailView.style.opacity = 1;
                    
                    flowSteps.forEach(s => s.classList.remove('active-step'));
                    document.getElementById(`step-${stepId}`).classList.add('active-step');
                }
            }

            flowSteps.forEach(step => {
                step.addEventListener('click', () => updateDetailView(step.dataset.step));
            });
            
            // Bucket Configurator
            const bucketCodeOutput = document.getElementById('bucket-code-output');
            const bucketPrivateBtn = document.getElementById('bucket-private');
            const bucketPublicBtn = document.getElementById('bucket-public');
            const sizeLimitInput = document.getElementById('bucket-size-limit');
            const mimeCheckboxes = document.querySelectorAll('.mime-type');

            function updateBucketCode() {
                const isPublic = bucketPublicBtn.classList.contains('active');
                const sizeLimit = sizeLimitInput.value || 0;
                const sizeBytes = sizeLimit * 1024 * 1024;
                const allowedMimes = Array.from(mimeCheckboxes)
                    .filter(cb => cb.checked)
                    .map(cb => `"${cb.value}"`)
                    .join(', ');

                const code = `
# supabase_client: Supabase í´ë¼ì´ì–¸íŠ¸
# ë²„í‚· ì´ë¦„: 'my-image-bucket'

res = supabase_client.storage.create_bucket(
    'my-image-bucket',
    options={
        "public": ${isPublic},
        "allowed_mime_types": [${allowedMimes}],
        "file_size_limit": ${sizeBytes} # ${sizeLimit}MB
    }
)`;
                bucketCodeOutput.textContent = code.trim();
            }

            bucketPrivateBtn.addEventListener('click', () => {
                bucketPrivateBtn.classList.add('active');
                bucketPublicBtn.classList.remove('active');
                updateBucketCode();
            });
            bucketPublicBtn.addEventListener('click', () => {
                bucketPublicBtn.classList.add('active');
                bucketPrivateBtn.classList.remove('active');
                updateBucketCode();
            });
            sizeLimitInput.addEventListener('input', updateBucketCode);
            mimeCheckboxes.forEach(cb => cb.addEventListener('change', updateBucketCode));

            // RLS Configurator
            const rlsScenarioSelect = document.getElementById('rls-scenario');
            const rlsCodeOutput = document.getElementById('rls-code-output');

            function updateRlsCode() {
                const scenario = rlsPolicies[rlsScenarioSelect.value];
                const code = `
-- ì„¤ëª…: ${scenario.description}
${scenario.sql}
                `;
                rlsCodeOutput.textContent = code.trim();
            }
            rlsScenarioSelect.addEventListener('change', updateRlsCode);

            // Code Explorer
            document.getElementById('code-output').textContent = fullCode.trim();

            // Error Simulator
            const errorScenarioSelect = document.getElementById('error-scenario');
            const errorOutput = document.getElementById('error-output');

            function updateErrorView() {
                const error = errorData[errorScenarioSelect.value];
                errorOutput.innerHTML = `
                    <div class="content-card p-4">
                        <h4 class="font-bold text-lg mb-2">HTTP ìƒíƒœ ì½”ë“œ</h4>
                        <p class="text-xl font-mono bg-red-100 text-red-800 rounded-md py-1">${error.code}</p>
                    </div>
                    <div class="content-card p-4">
                        <h4 class="font-bold text-lg mb-2">ë°œìƒ ì›ì¸</h4>
                        <p>${error.reason}</p>
                    </div>
                    <div class="content-card p-4">
                        <h4 class="font-bold text-lg mb-2">í•´ê²° ì „ëµ</h4>
                        <p>${error.solution}</p>
                    </div>
                `;
            }
            errorScenarioSelect.addEventListener('change', updateErrorView);


            // Initial state
            updateDetailView('client');
            updateBucketCode();
            updateRlsCode();
            updateErrorView();
            switchTab('flow');
        });
    </script>

</body>
</html>
